# Environment: "development", "production"
env: "development"
version: "1.0.0"

# Global defaults - applies to all chains unless overridden
defaults:
  from_latest: true # start indexing from the latest block
  poll_interval: "5s" # how often to poll for new blocks
  reorg_rollback_window: 20 # number of blocks to roll back on reorg
  client:
    timeout: "20s" # RPC timeout per request
    max_retries: 3 # max retries per RPC call
    retry_delay: "5s" # delay between retries
  throttle:
    rps: 8 # requests per second per RPC node
    burst: 16 # burst capacity
    batch_size: 100 # default batch size when fetching
    concurrency: 3 # number of concurrent workers

chains:
  tron_mainnet:
    type: "tron"
    start_block: 75144237
    poll_interval: "8s" # override default poll interval
    nodes:
      - url: "https://api.trongrid.io"
        auth: # API key required for higher rate limits
          type: "header"
          key: "TRON-PRO-API-KEY"
          value: ""
      - url: "https://tron-rpc.publicnode.com"
    client:
      max_retries: 5 # override global max retries
      retry_delay: "10s"
    throttle:
      rps: 5
      burst: 8

  ethereum_mainnet:
    type: "evm"
    start_block: 23080871
    poll_interval: "3s" # faster polling for Ethereum
    client:
      timeout: "30s" # override global timeout
    throttle:
      batch_size: 20 # smaller batch size
    nodes:
      - url: "https://ethereum-rpc.publicnode.com"
      - url: "https://eth.rpc.blxrbdn.com"
      - url: "https://eth.llamarpc.com"
      - url: "https://rpc.mevblocker.io"
      # - url: "https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}"  # optional

  bnb_mainnet:
    internal_code: "BNB_MAINNET"
    type: "evm"
    start_block: 59040717
    reorg_rollback_window: 30 # custom rollback depth for BNB
    nodes:
      - url: "https://bsc-rpc.publicnode.com"
      - url: "https://bsc.blockrazor.xyz"
      - url: "https://bnb.rpc.subquery.network/public"

  bitcoin_testnet:
    internal_code: "BTC_TESTNET"
    type: "btc"
    start_block: 4440000 # recent testnet block
    poll_interval: "60s" # Bitcoin blocks ~10 minutes
    confirmations: 1
    reorg_rollback_window: 100
    nodes:
      - url: "https://bitcoin-testnet-rpc.publicnode.com"
      - url: "https://blockstream.info/testnet/api"
      - url: "https://api.blockcypher.com/v1/btc/test3"
    client:
      timeout: "30s"
      max_retries: 5
      retry_delay: "10s"
    throttle:
      rps: 10
      burst: 20
      batch_size: 10 # Bitcoin processes sequentially
      concurrency: 1 # No parallel fetching needed

  bitcoin_mainnet:
    internal_code: "BTC_MAINNET"
    type: "btc"
    start_block: 850000
    poll_interval: "60s"
    confirmations: 1
    reorg_rollback_window: 100
    nodes:
      - url: "https://bitcoin-rpc.publicnode.com"
      - url: "https://blockstream.info/api"
      - url: "https://api.blockcypher.com/v1/btc/main"
    client:
      timeout: "30s"
      max_retries: 5
      retry_delay: "10s"
    throttle:
      rps: 10
      burst: 20
      batch_size: 10
      concurrency: 1

  solana_mainnet:
    network_id: "solana"
    internal_code: "SOL_MAINNET"
    type: "sol"
    start_block: 0
    poll_interval: "2s"
    nodes:
      - url: "https://solana-rpc.publicnode.com"
      - url: "https://api.mainnet.solana.com"
      - url: "https://solana.drpc.org"
      - url: "https://solana.leorpc.com/?api_key=FREE"
      - url: "https://solana.api.pocket.network"
      - url: "https://public.rpc.solanavibestation.com"
      # - url: "https://solana-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}"  # optional
      # - url: "https://solana-mainnet.g.quicknode.pro/${QUICKNODE_KEY}/"  # optional
    client:
      timeout: "15s"
      max_retries: 2
      retry_delay: "1s"
    throttle:
      rps: 120
      burst: 200
      batch_size: 80
      concurrency: 16
      parallel: true

  solana_devnet:
    network_id: "solana_devnet"
    internal_code: "SOL_DEVNET"
    type: "sol"
    start_block: 0
    poll_interval: "2s"
    nodes:
      - url: "https://api.devnet.solana.com"
      - url: "https://solana-devnet.api.onfinality.io/public"
    client:
      timeout: "12s"
      max_retries: 2
      retry_delay: "500ms"
    throttle:
      rps: 80
      burst: 160
      batch_size: 40
      concurrency: 12
      parallel: true

  sui_mainnet:
    # Example Sui network using gRPC-based node endpoint.
    # Adjust network_id, internal_code, start_block (checkpoint sequence), and URL to your setup.
    network_id: "sui_mainnet"
    internal_code: "SUI_MAINNET"
    type: "sui"
    start_block: 0
    poll_interval: "5s"
    nodes:
      - url: "fullnode.mainnet.sui.io:443" # e.g. 127.0.0.1:9000
      - url: "sui-mainnet.nodeinfra.com:443"

# Infrastructure services
services:
  port: 8080 # Health check and monitoring server port

  worker:
    manual:
      enabled: false
    catchup:
      enabled: false
    rescanner:
      enabled: true
    regular:
      enabled: true
    mempool:
      enabled: true # Bitcoin-only: 0-conf transaction tracking for instant UX

  nats:
    url: "nats://localhost:4222"
    subject_prefix: "indexer" # optional subject prefix
    username: "" # optional username
    password: "" # optional password
    # TLS configuration (optional, defaults to ./certs/ if not specified)
    tls:
      client_cert: "./certs/client-cert.pem" # defaults to ./certs/client-cert.pem
      client_key: "./certs/client-key.pem" # defaults to ./certs/client-key.pem
      ca_cert: "./certs/rootCA.pem" # defaults to ./certs/rootCA.pem

  database:
    url: "postgres://postgres:postgres@localhost:5432/postgres"

  redis:
    url: "localhost:6379" # supports redis://host:port or rediss://host:port (TLS)
    password: ""
    mtls: false # enable mutual TLS with client certificates (production only)

  kvstore:
    type: "consul"
    consul:
      scheme: "http"
      address: "127.0.0.1:8500"
      folder: "indexer"
      token: ""
      # http_auth:                   # optional: enable if consul is secured
      #   username: ""
      #   password: ""

  bloomfilter:
    type: "redis" # redis or in_memory
    wallet_address_repo: "wallet_address"
    batch_size: 1000
    redis:
      key_prefix: "wallet_bloom"
      error_rate: 0.01 # expected false positive rate
      capacity: 1000000 # max number of addresses
    in_memory: # alternative config (if not using redis)
      expected_items: 1000000
      false_positive_rate: 0.01
