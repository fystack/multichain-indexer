# Environment: "development", "production"
env: "development"
version: "1.0.0"

# Global defaults - applies to all chains unless overridden
defaults:
  from_latest: true # start indexing from the latest block
  poll_interval: "5s" # how often to poll for new blocks
  reorg_rollback_window: 20 # number of blocks to roll back on reorg
  client:
    timeout: "20s" # RPC timeout per request
    max_retries: 3 # max retries per RPC call
    retry_delay: "5s" # delay between retries
  throttle:
    rps: 8 # requests per second per RPC node
    burst: 16 # burst capacity
    batch_size: 100 # default batch size when fetching
    concurrency: 3 # number of concurrent workers

chains:
  tron_mainnet:
    type: "tron"
    start_block: 75144237
    poll_interval: "8s" # override default poll interval
    nodes:
      - url: "https://api.trongrid.io"
        auth: # API key required for higher rate limits
          type: "header"
          key: "TRON-PRO-API-KEY"
          value: ""
      - url: "https://tron-rpc.publicnode.com"
    client:
      max_retries: 5 # override global max retries
      retry_delay: "10s"
    throttle:
      rps: 5
      burst: 8

  ethereum_mainnet:
    type: "evm"
    start_block: 23080871
    poll_interval: "3s" # faster polling for Ethereum
    client:
      timeout: "30s" # override global timeout
    throttle:
      batch_size: 20 # smaller batch size
    nodes:
      - url: "https://ethereum-rpc.publicnode.com"
      - url: "https://eth.rpc.blxrbdn.com"
      - url: "https://eth.llamarpc.com"
      - url: "https://rpc.mevblocker.io"
      # - url: "https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}"  # optional

  bnb_mainnet:
    internal_code: "BNB_MAINNET"
    type: "evm"
    start_block: 59040717
    reorg_rollback_window: 30 # custom rollback depth for BNB
    nodes:
      - url: "https://bsc-rpc.publicnode.com"
      - url: "https://bsc.blockrazor.xyz"
      - url: "https://bnb.rpc.subquery.network/public"

  bitcoin_testnet:
    network_id: "bitcoin_testnet"
    internal_code: "BTC_TESTNET"
    type: "btc"
    start_block: 2500000 # recent testnet block
    poll_interval: "60s" # Bitcoin blocks ~10 minutes
    confirmations: 6 # wait for 6 confirmations before indexing
    reorg_rollback_window: 100 # Bitcoin can have deeper reorgs than EVM chains
    nodes:
      - url: "https://blockstream.info/testnet/api"
      - url: "https://api.blockcypher.com/v1/btc/test3"
    client:
      timeout: "30s"
      max_retries: 5
      retry_delay: "10s"
    throttle:
      rps: 10
      burst: 20
      batch_size: 10 # Bitcoin processes sequentially
      concurrency: 1 # No parallel fetching needed

  bitcoin_mainnet:
    network_id: "bitcoin"
    internal_code: "BTC_MAINNET"
    type: "btc"
    start_block: 850000
    poll_interval: "60s"
    confirmations: 6
    reorg_rollback_window: 100
    nodes:
      - url: "https://blockstream.info/api"
      - url: "https://api.blockcypher.com/v1/btc/main"
    client:
      timeout: "30s"
      max_retries: 5
      retry_delay: "10s"
    throttle:
      rps: 10
      burst: 20
      batch_size: 10
      concurrency: 1

# Infrastructure services
services:
  port: 8080 # Health check and monitoring server port

  worker:
    manual:
      enabled: false
    catchup:
      enabled: false
    rescanner:
      enabled: true
    regular:
      enabled: true

  nats:
    url: "nats://localhost:4222"
    subject_prefix: "indexer"  # optional subject prefix
    username: ""               # optional username
    password: ""               # optional password
    # TLS configuration (optional, defaults to ./certs/ if not specified)
    tls:
      client_cert: "./certs/client-cert.pem"  # defaults to ./certs/client-cert.pem
      client_key: "./certs/client-key.pem"    # defaults to ./certs/client-key.pem
      ca_cert: "./certs/rootCA.pem"           # defaults to ./certs/rootCA.pem

  database:
    url: "postgres://postgres:postgres@localhost:5432/postgres"

  redis:
    url: "localhost:6379"                           # supports redis://host:port or rediss://host:port (TLS)
    password: ""
    mtls: false                                     # enable mutual TLS with client certificates (production only)

  kvstore:
    type: "consul"
    consul:
      scheme: "http"
      address: "127.0.0.1:8500"
      folder: "indexer"
      token: ""
      # http_auth:                   # optional: enable if consul is secured
      #   username: ""
      #   password: ""

  bloomfilter:
    type: "redis" # redis or in_memory
    wallet_address_repo: "wallet_address"
    batch_size: 1000
    redis:
      key_prefix: "bloomfilter"
      error_rate: 0.01 # expected false positive rate
      capacity: 1000000 # max number of addresses
    in_memory: # alternative config (if not using redis)
      expected_items: 1000000
      false_positive_rate: 0.01
